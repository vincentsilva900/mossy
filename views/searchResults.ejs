<h2>Search Results</h2>

<% if (users.length === 0) { %>
  <p>No users found.</p>
<% } else { %>
  <% users.forEach(result => { %>
    <div style="margin-bottom: 1rem; display: flex; align-items: center; justify-content: space-between;">
      <div>
        <a href="/user/<%= result._id %>">
          <img src="<%= result.profilePic %>" width="30" style="border-radius: 50%; margin-right: 0.5rem;" />
          <%= result.username %>
        </a>
      </div>

      <% if (result._id.toString() !== session.userId.toString()) { %>
        <% const isFriend = result.friends?.some(friend => friend._id?.toString() === session.userId.toString()); %>

        <% if (!isFriend) { %>
          <form action="/user/friend/<%= result._id %>" method="POST" style="margin-left: 1rem;">
            <button type="submit" style="font-size: 0.8rem;">➕ Add Friend</button>
          </form>
        <% } else { %>
          <form action="/user/unfriend/<%= result._id %>" method="POST" style="margin-left: 1rem;">
            <button type="submit" style="font-size: 0.8rem;">❌ Remove Friend</button>
          </form>
        <% } %>
      <% } %>
    </div>
  <% }) %>
<% } %>

<link rel="stylesheet" href="/css/mossbook.css">

<!-- ğŸ”™ Back to Your Own Profile -->
<div style="margin: 1rem 0;">
    <a href="/user/profile">
      <button style="background-color: #ffccf9; border: none; padding: 0.5rem 1rem; border-radius: 10px; font-weight: bold; cursor: pointer;">
        â¬…ï¸ Back to My Profile
      </button>
    </a>
  </div>

<h2 style="text-align:center;"><%= mossbook.title %></h2>
<h4 style="text-align:center;">Page <%= page + 1 %> / 25</h4>

<script src="/js/mossbook.js" defer></script>


<form action="/mossbook/<%= mossbook._id %>/page/<%= page %>" method="POST" enctype="multipart/form-data" style="text-align:center;">

  
    <div id="post-drop-zone" class="drop-zone">
        <p>ğŸ“· Drop an image for your post (optional)</p>
        <img id="postPreview" src="" style="max-width: 150px; display: none; margin: 0.5rem auto;" />
        <input type="file" name="image" id="postFileInput" hidden accept="image/*" />
        <button type="button" onclick="document.getElementById('postFileInput').click()">UploadImage</button>
      </div>
      <% if (mossbook.pages[page].image) { %>
        <div style="margin-top: 1rem;">
          <p style="color: #446144;">ğŸŒ¿ Current Saved Image:</p>
          <img src="<%= mossbook.pages[page].image %>" style="max-width: 200px; border-radius: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);" />
        </div>
      <% } %>
      
  <textarea name="text" rows="5" cols="40" placeholder="Write your memory..."><%= mossbook.pages[page].text || '' %></textarea>
  <br><br>
  <button type="submit">ğŸ’¾ Save Page</button>
</form>

<div style="text-align:center; margin-top: 2rem;">
  <% if (page > 0) { %>
    <a href="/mossbook/<%= mossbook._id %>/page/<%= page - 1 %>">â¬…ï¸ Previous</a>
  <% } %>
  <% if (page < 24) { %>
    <a href="/mossbook/<%= mossbook._id %>/page/<%= page + 1 %>" style="margin-left:2rem;">Next â¡ï¸</a>
  <% } %>
</div>
<script>
    const postZone = document.getElementById('post-drop-zone');
    const postFileInput = document.getElementById('postFileInput');
    const postPreview = document.getElementById('postPreview');
  
    postZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      postZone.classList.add('dragover');
    });
  
    postZone.addEventListener('dragleave', () => {
      postZone.classList.remove('dragover');
    });
  
    postZone.addEventListener('drop', (e) => {
      e.preventDefault();
      postZone.classList.remove('dragover');
  
      if (e.dataTransfer.files.length) {
        const file = e.dataTransfer.files[0];
        postFileInput.files = e.dataTransfer.files;
  
        const reader = new FileReader();
        reader.onload = e => {
          postPreview.src = e.target.result;
          postPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
  
    postFileInput.addEventListener('change', () => {
      const file = postFileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          postPreview.src = e.target.result;
          postPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
  </script>
  